<!DOCTYPE html>
<html lang="ja">
<head>
Â  Â  <title>Line Stamp Downloader</title>
Â  Â  <meta charset="utf-8">
Â  Â  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
Â  Â  <meta http-equiv="Pragma" content="no-cache" />
Â  Â  <meta http-equiv="Expires" content="0" />
Â  Â  <meta http-equiv="X-UA-Compatible" content="IE=edge">
Â  Â  <meta name="viewport" content="width=device-width initial-scale=1, viewport-fit=cover"/>
Â  Â  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
Â  Â  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
Â  Â  <link rel="stylesheet" href="style.css" />
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-83D01EDLD6"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-83D01EDLD6');
    </script>
</head>
<body>
    <h1 class="title">Line Stamp Downloader</h1>
    <div id="informations">
        <div class="information">
            <div class="window">
                <h1>Download</h1>
                <a id="downloadLink" href="#" download="images.zip" style="display:none;">ZIPã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a><br>
                <input type="text" placeholder="URL" id="url"><br>
                <button class="basic_button" onclick="download()">Get</button>      
            </div>
        </div>
    </div>
Â  Â  <button class="change_theme" onclick="change_theme()">ğŸ”¦</button>

Â  Â  <script>
Â  Â  Â  Â  async function get_content(url) {
Â  Â  Â  Â  Â  Â  const response = await fetch(url);
Â  Â  Â  Â  Â  Â  if (!response.ok) throw new Error("Error");
Â  Â  Â  Â  Â  Â  return await response.blob();
Â  Â  Â  Â  }

Â  Â  Â  Â  async function download() {
Â  Â  Â  Â  Â  Â  const zip = new JSZip();
Â  Â  Â  Â  Â  Â  const urlInput = document.getElementById('url').value.trim();
Â  Â  Â  Â  Â  Â  const id = urlInput.split("/")[5];
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const response = await axios.get(`https://stickershop.line-scdn.net/products/0/0/1/${id}/iphone/productInfo.meta`);
Â  Â  Â  Â  Â  Â  Â  Â  const stickers = response.data.stickers;
                const package_name = response.data.title.en;
Â  Â  Â  Â  Â  Â  Â  Â  const fetchAll = stickers.map(async (sticker) => {
Â  Â                  const s_id = sticker.id;
                Â  Â  const imageUrl = `https://stickershop.line-scdn.net/stickershop/v1/sticker/${s_id}/iphone/sticker@2x.png`;
                Â  Â  try {
Â  Â  Â                  Â  const blob = await get_content(imageUrl);
Â  Â  Â                  Â  zip.file(`${s_id}.png`, blob);
Â  Â                  } catch (err) {
Â  Â  Â  Â                  console.warn(err);
Â  Â                  }
                });
                await Promise.all(fetchAll);
Â  Â  Â  Â  Â  Â  Â  Â  const zipBlob = await zip.generateAsync({ type: 'blob' });
Â  Â  Â  Â  Â  Â  Â  Â  const zipUrl = URL.createObjectURL(zipBlob);
Â  Â  Â  Â  Â  Â  Â  Â  const link = document.getElementById('downloadLink');
                link.download=`${package_name}.zip`;
Â  Â  Â  Â  Â  Â  Â  Â  link.href = zipUrl;
Â  Â  Â  Â  Â  Â  Â  Â  link.style.display = 'inline';
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.warn(error);
Â  Â  Â  Â  Â  Â  Â  Â  alert("ã‚¹ã‚¿ãƒ³ãƒ—æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
        $(function(){
            const theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? "dark" : "light";
            const html = document.documentElement;
            html.setAttribute('data-theme', theme);
        });
Â  Â  Â  Â  function change_theme() {
Â  Â  Â  Â  Â  Â  const html = document.documentElement;
Â  Â  Â  Â  Â  Â  const theme = html.getAttribute('data-theme');
Â  Â  Â  Â  Â  Â  const to_theme = theme === 'light' ? 'dark' : 'light';
Â  Â  Â  Â  Â  Â  html.setAttribute('data-theme', to_theme);
Â  Â  Â  Â  }
Â  Â  </script>
</body>
</html>
