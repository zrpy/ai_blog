---
title: 基本的なスクレイピング
tags: scrape,scraping,anti-bot
---
# スクレイピングの方法

「スクレイピングを始めたいけど、どうすればいいか分からない」という方は多いと思います。

中には、リクエストを送ってもアクセスを拒否されたり、意味のわからないレスポンスが返ってきたりして、困った経験がある人もいるのではないでしょうか。

この記事では、**正しくスクレイピングする方法**や**ブロックされないための対策**について解説します。

---

## なぜブロックされるのか？

スクレイピング時にリクエストが拒否される主な理由は次の3つです：

1. リクエストヘッダーが不正・不足している  
2. IPアドレスがブロックされている  
3. AntiBotシステムに人間ではないと判定された

それぞれの対処法について詳しく説明します。

---

## 1. リクエストヘッダーの問題

リクエストヘッダーが不十分だと、多くのサイトは**不正アクセス**と判断し、正常なレスポンスを返してくれません。

### ▶ 対策①：Seleniumなどのブラウザ自動操作ツールを使う

**Selenium** や **Playwright**、**DrissionPage** などのツールは、実際のブラウザを自動操作するため、ヘッダーやCookieなどが自動で付与され、検知されにくくなります。

特に `DrissionPage` は、検知回避に特化したドライバとして人気です。

### ▶ 対策②：DevToolsからヘッダーを取得する

Chromeの開発者ツール（DevTools）を使い、**実際のリクエストに使われているヘッダーやCookieをコピーして再現**することで、ブラウザと同じようなリクエストを作成できます。

例えば、`User-Agent` や `Referer`、`Cookie` をリクエストヘッダーに入れることで、サイト側に「本物のユーザー」であると認識されやすくなります。

---

## 2. IPアドレスの規制

一定回数アクセスしたり、不審な動きがあったりすると、**IPアドレスごとブロック**されることがあります。

### ▶ 対策：VPN・プロキシ・SIMの使い分け

- **VPN**：国をまたいだIP変更が可能  
- **プロキシ**：複数のIPを切り替えて使える  
- **SIMカードの交換**：モバイル環境なら物理的にIPを変更可能  

特に他国のIPを使うと、国内制限を回避できることもあります。ただし、対象のサイトが**国外IPを禁止している**場合もあるため注意が必要です。

---

## 3. AntiBotシステム（Bot対策）

多くのサイトでは、**Cloudflare** などのAntiBotサービスが導入されており、Botによるアクセスを検知・ブロックしています。

### ▶ 対策①：captcha解決サービスを利用する

`2Captcha` や `Anti-Captcha` などのサービスを使えば、CAPTCHAのトークンを取得して、それをリクエストに含めることで正当なアクセスと見なされます。

### ▶ 対策②：JavaScriptを解析する

Cloudflareの検出は多くの場合、JavaScriptの実行結果を見て判断されます。

ツールを使わずに**JavaScriptを自力で解析し、生成されるトークンやCookieを再現**できれば、コストをかけずに回避可能です。ただし、かなり高度な技術が必要です。

---

## まとめ

| 問題                     | 対策方法                                                             |
|--------------------------|----------------------------------------------------------------------|
| リクエストヘッダーが不正 | ブラウザ自動操作ツール / DevToolsでヘッダーコピー                   |
| IPがブロックされた       | VPN / プロキシ / SIMカードの交換                                     |
| Botと判定された          | Captcha解決サービスの利用 / JavaScript解析による自力回避              |

スクレイピングは奥が深く、技術と工夫が必要です。ルールを守って、対象サイトの利用規約を確認しながら行いましょう。
